#!/bin/bash

# Pre-commit hook for Bisq Mobile
# Runs quick checks before allowing commit

echo "üîç Running pre-commit checks..."
echo ""

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

print_error() {
    echo -e "${RED}‚ùå $1${NC}"
}

print_success() {
    echo -e "${GREEN}‚úÖ $1${NC}"
}

print_warning() {
    echo -e "${YELLOW}‚ö†Ô∏è  $1${NC}"
}

# Get list of staged Kotlin files
STAGED_KOTLIN_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "\.kt$")

if [ -z "$STAGED_KOTLIN_FILES" ]; then
    print_success "No Kotlin files to check"
    exit 0
fi

echo "Checking ${#STAGED_KOTLIN_FILES[@]} Kotlin file(s)..."
echo ""

# Check for TODO/FIXME in staged files (Warning only)
echo "üìù Checking for TODO/FIXME comments..."
TODO_FOUND=false

for file in $STAGED_KOTLIN_FILES; do
    if [ -f "$file" ]; then
        if grep -q "TODO\|FIXME" "$file"; then
            if [ "$TODO_FOUND" = false ]; then
                echo ""
                print_warning "TODO/FIXME comments found:"
                TODO_FOUND=true
            fi
            echo "  üìÅ $file"
            grep -n "TODO\|FIXME" "$file" | sed 's/^/    /'
        fi
    fi
done

if [ "$TODO_FOUND" = true ]; then
    echo ""
    print_warning "Consider addressing TODO/FIXME comments before committing"
    echo ""
    # Don't exit - just warn
else
    print_success "No TODO/FIXME comments found!"
    echo ""
fi

# Success!
print_success "Pre-commit checks passed! ‚ú®"
echo ""

exit 0
