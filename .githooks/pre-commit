#!/bin/bash

# Pre-commit hook for Bisq Mobile
# Checks for TODO/FIXME comments (warning only)
# Note: ktlint checks have been moved to pre-push hook

echo "ğŸ” Running pre-commit checks..."
echo ""

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

print_error() {
    echo -e "${RED}âŒ $1${NC}"
}

print_success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

print_warning() {
    echo -e "${YELLOW}âš ï¸  $1${NC}"
}

# ============================================
# CHECK FOR TODO/FIXME (Warning only)
# ============================================
echo "ğŸ“ Checking for TODO/FIXME comments..."
TODO_FOUND=false

# Get staged Kotlin files (using same method as ktlint)
STAGED_KOTLIN_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "\.kt$")

for file in $STAGED_KOTLIN_FILES; do
    if [ -f "$file" ]; then
        if grep -q "TODO\|FIXME" "$file"; then
            if [ "$TODO_FOUND" = false ]; then
                echo ""
                print_warning "TODO/FIXME comments found:"
                TODO_FOUND=true
            fi
            echo "  ğŸ“ $file"
            grep -n "TODO\|FIXME" "$file" | sed 's/^/    /'
        fi
    fi
done

if [ "$TODO_FOUND" = true ]; then
    echo ""
    print_warning "Consider addressing TODO/FIXME comments before committing"
    echo ""
    # Don't exit - just warn
else
    print_success "No TODO/FIXME comments found!"
    echo ""
fi

# Success!
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
print_success "Pre-commit checks complete! âœ¨"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

exit 0
